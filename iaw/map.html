<html>
    <head>
        <title>Imputation Around the World</title>
        <link rel="stylesheet" href="https://unpkg.com/leaflet@1.8.0/dist/leaflet.css"
        integrity="sha512-hoalWLoI8r4UszCkZ5kL8vayOGVae1oxXe/2A4AO6J9+580uKHDO3JdHb7NzwwzK5xr/Fs0W40kiNHxM9vyTtQ=="
        crossorigin=""/>
        <script src="https://unpkg.com/leaflet@1.8.0/dist/leaflet.js"
        integrity="sha512-BB3hKbKWOc9Ez/TAwyWxNXeoV9c1v6FIeYiBieIWkpLjauysF18NzgR1MBNBXf8/KABdlkX68nAhlwcDFLGPCQ=="
        crossorigin=""></script>
        
        <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
        <script src="https://cdn.jsdelivr.net/npm/papaparse@5.3.0/papaparse.min.js"></script>
        
        <style>
            #window{
                width: 100%;
                height: 100%;
                margin:0;
                padding:0;
            }
        </style>

    </head>
    <body>
        <div id="window"></div>
        <script>           
            var l= L.map('window').setView([0, 0], 3);
            l.setMaxBounds(l.getBounds());
            l.options.minZoom = 2;
            l.options.maxZoom = 7;
            
        
            var tiles =  L.tileLayer('https://tiles.stadiamaps.com/tiles/alidade_smooth_dark/{z}/{x}/{y}{r}.png', {
                maxzoom: 3,
                attribution: '&copy; <a href="https://stadiamaps.com/">Stadia Maps</a>, &copy; <a href="https://openmaptiles.org/">OpenMapTiles</a> &copy; <a href="http://openstreetmap.org">OpenStreetMap</a> contributors'
            }).addTo(l);

            $.get('./map_clean.csv', function(csvString) {

            // Use PapaParse to convert string to array of objects
                var data = Papa.parse(csvString, {header: true, dynamicTyping: true}).data;

                // For each row in data, create a marker and add it to the map
                // For each row, columns `Latitude`, `Longitude`, and `Title` are required
                for (var i in data) {
                    
                    var row = data[i];
                    console.log(row.Population_Label)

                    var marker = L.circle([row.lat, row.lng], {
                        color:"white",
                        fillColor: row.color,
                        weight:0.5,
                        fillOpacity: 0.1,
                        radius: 50000*row.N_log,
                    }).bindPopup("<b>LABEL: </b>"+row.Population_Label+'<br>'+
                                "<b>LOCATION: </b>"+row.Population_Location+'<br>'+
                                "<b>CATEGORY: </b>"+row.Region_Category+'<br>'+
                                "<b>SIZE: </b>"+row.N+'<br>'+
                                "<b>LATITUDE: </b>"+row.lat+'<br>'+
                                "<b>LONGITUDE: </b>"+row.lng+'<br>'+
                                "<b>ARRAY: </b>"+row.Array+'<br>'
                                ).bindTooltip(row.Population_Label).openTooltip();;
                    marker.addTo(l);
                    }

            });
           

        
            
            // var circle = L.circle([data[0].lat, data[0].lng], {
            //     color: 'red',
            //     fillColor: '#f03',
            //     fillOpacity: 0.5,
            //     radius: 500*data[0].N_log
            // }).addTo(map).bindPopup('TESTING');

            var popup = L.popup()
                .setLatLng([0, 0])
                .setContent('Welcome to the Imputation Around the World Project. Clik on any marker to learn more about the population!')
                .openOn(l);
        
        
        </script>
       

    </body>
</html>